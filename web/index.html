<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ApollodB - Music Emotion Analysis</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <nav class="appbar">
    <div class="appbar-left">
      <div class="logo">ApollodB</div>
      <div class="tabs">
        <a class="navbar-tab active" data-tab="analysis" href="#analysis">Analysis</a>
        <a class="navbar-tab" data-tab="iem" href="#iem">IEM Database</a>
        <a class="navbar-tab" data-tab="references" href="#references">References</a>
        <a class="navbar-tab" data-tab="about" href="#about">About</a>
      </div>
    </div>
    <div class="appbar-right">
      <a id="bmc-link" class="bmc-btn" href="https://buymeacoffee.com/parikshitkumar" target="_blank" rel="noopener" aria-label="Buy me a coffee">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 8h11a3 3 0 0 1 0 6H5V8zm11 8H5v1a3 3 0 0 0 3 3h5a3 3 0 0 0 3-3v-1z" fill="#2b1a12"/><path d="M19 8v6a3 3 0 0 0 0-6z" fill="#2b1a12"/></svg>
      </a>
      <a class="icon-btn" href="https://github.com/parikshitkumar1" target="_blank" aria-label="GitHub">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.02c-3.34.73-4.04-1.61-4.04-1.61-.55-1.4-1.34-1.77-1.34-1.77-1.09-.75.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.48.99.11-.78.42-1.3.76-1.6-2.67-.3-5.47-1.34-5.47-5.96 0-1.32.47-2.39 1.24-3.24-.12-.3-.54-1.52.12-3.17 0 0 1.01-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.29-1.55 3.3-1.23 3.3-1.23.66 1.65.24 2.87.12 3.17.77.85 1.24 1.92 1.24 3.24 0 4.63-2.8 5.66-5.48 5.96.43.37.81 1.1.81 2.22v3.29c0 .32.22.7.83.58A12 12 0 0 0 12 .5z"/></svg>
      </a>
      <a class="icon-btn" href="https://www.linkedin.com/in/parikshitkumar1/" target="_blank" aria-label="LinkedIn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM.5 8h4V24h-4V8zm7 0h3.8v2.2h.05c.53-1 1.84-2.2 3.79-2.2 4.05 0 4.8 2.67 4.8 6.15V24h-4v-7.1c0-1.7-.03-3.88-2.36-3.88-2.36 0-2.72 1.84-2.72 3.75V24h-4V8z"/></svg>
      </a>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1 class="title">ApollodB: Emotion‑aware mastering with state‑of‑the‑art deep learning</h1>
      <p class="subtitle">Powered by models trained on the DEAM dataset, ApollodB maps your track’s emotion in the Valence–Arousal space and exports studio‑grade EQ curves and high‑fidelity EQed audio. No data is stored or used for model training.</p>
      <div class="hero-highlights">
        <div class="highlight">
          <span class="hi-title">Emotion Intelligence</span>
          <span class="hi-sub">Valence–Arousal mapping with confidence</span>
        </div>
        <div class="highlight">
          <span class="hi-title">Studio-Grade EQ</span>
          <span class="hi-sub">Wavelet/Parametric/Graphic presets</span>
        </div>
        <div class="highlight">
          <span class="hi-title">Batch Workflow</span>
          <span class="hi-sub">Aggregate analysis & per-track exports</span>
        </div>
      </div>
    </section>

    <!-- Quick Start Guide -->
    <details class="guide-panel" open>
      <summary class="guide-header">Quick Start Guide</summary>
      <div class="guide-content">
        <div class="guide-steps">
          <div class="guide-step">
            <div class="step-num">1</div>
            <div class="step-text">
              <strong>Upload Audio</strong>
              <span>Select or drag an audio file (MP3, WAV, FLAC, M4A, OGG). For batch analysis, switch to Batch mode.</span>
            </div>
          </div>
          <div class="guide-step">
            <div class="step-num">2</div>
            <div class="step-text">
              <strong>Adjust Parameters</strong>
              <span>Set EQ aggression (0-1), style (Wavelet/Parametric/Graphic), and optional warmth/presence/air macros.</span>
            </div>
          </div>
          <div class="guide-step">
            <div class="step-num">3</div>
            <div class="step-text">
              <strong>Analyze</strong>
              <span>Click Analyze to predict emotion and generate EQ curves. Results show valence, arousal, and confidence scores.</span>
            </div>
          </div>
          <div class="guide-step">
            <div class="step-num">4</div>
            <div class="step-text">
              <strong>Export</strong>
              <span>Download EQed audio, spectrogram, or export EQ presets for Equalizer APO, AutoEQ, or other software.</span>
            </div>
          </div>
        </div>
      </div>
    </details>

    <!-- Analysis Section -->
    <section id="section-analysis" class="section active">
      <div class="content-container">
        <!-- Unified File Upload Dropzone -->
        <div class="upload-zone">
          <input id="audio-files" type="file" accept="audio/*" multiple class="file-input-hidden" />
          <div class="dropzone" id="dropzone">
            <div class="dropzone-text">
              <span class="dropzone-main">Drop audio files here</span>
              <span class="dropzone-sub">or <span class="dropzone-browse">browse</span> to choose</span>
            </div>
            <div class="dropzone-formats">MP3, WAV, FLAC, OGG, M4A — upload one or more files</div>
            <div class="dropzone-file" id="selected-files"></div>
          </div>
        </div>

        <div class="row settings">
          <label>EQ Aggression: <span id="agg-val">0.5</span></label>
          <input id="agg" type="range" min="0" max="1" step="0.05" value="0.5" />
          <label>EQ Style:</label>
          <select id="eq-style">
            <option>Wavelet</option>
            <option>Parametric</option>
            <option>Graphic</option>
          </select>
          <label style="margin-left:12px; display:inline-flex; align-items:center; gap:6px;">
            <input id="hq-linear" type="checkbox" aria-label="Enable High Quality Linear-Phase rendering (slower)" /> HQ linear-phase
          </label>
          <div class="macros" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:8px;">
            <label>Warmth: <span id="warmth-val">0.0</span></label>
            <input id="warmth" type="range" min="-1.5" max="1.5" step="0.1" value="0" />
            <label>Presence: <span id="presence-val">0.0</span></label>
            <input id="presence" type="range" min="-1.5" max="1.5" step="0.1" value="0" />
            <label>Air: <span id="air-val">0.0</span></label>
            <input id="air" type="range" min="-1.5" max="1.5" step="0.1" value="0" />
          </div>
        </div>
      </div>

      <div class="row">
        <button id="analyze-btn" aria-label="Analyze audio">Analyze</button>
        <button id="export-apo" aria-label="Export EQ for Equalizer APO" title="Equalizer APO export">Export APO</button>
        <button id="export-autoeq-json" aria-label="Export EQ as AutoEQ JSON" title="AutoEQ JSON export">AutoEQ JSON</button>
        <button id="export-autoeq-csv" aria-label="Export EQ as AutoEQ CSV" title="AutoEQ CSV export">AutoEQ CSV</button>
      </div>

      <div id="status" class="status"></div>

      <!-- Results container (required by JS) -->
      <section id="results" class="panel" style="display:none;"></section>

      <!-- Removed legacy inner tab panes to avoid duplicate IDs -->
    </section>

    <section id="section-iem" class="section" aria-hidden="true">
      <div class="header">
        <h1>IEM Database</h1>
      </div>
      <div class="panel">
        <h3>Curated IEM Database</h3>
        <p class="muted">Explore in-ear monitors (IEMs) aligned with emotion signatures and EQ targets. This section provides a curated list and guidance for pairing EQ with IEM character.</p>
        <div class="grid-2">
          <div>
            <label for="iem-search" class="small muted">Search</label>
            <input id="iem-search" type="text" placeholder="Search IEMs, signatures, notes" />
          </div>
          <div>
            <label for="iem-price-filter" class="small muted">Price</label>
            <select id="iem-price-filter">
              <option value="all">All</option>
              <option value="under100">Under $100</option>
              <option value="100-500">$100–$500</option>
              <option value=">500">Over $500</option>
            </select>
          </div>
        </div>
        <div id="iem-featured" class="grid-3" style="margin-top:12px;"></div>
        <div class="iem-table-wrap">
          <table class="iem-table">
            <thead>
              <tr><th>Name</th><th>Signature</th><th>Valence Match</th><th>Price</th></tr>
            </thead>
            <tbody id="iem-tbody"></tbody>
          </table>
        </div>
        <p class="muted small">Note: This is informational and does not alter the model’s behavior.</p>
      </div>
    </section>

    <!-- References Section -->
    <section id="section-references" class="section" aria-hidden="true">
      <div class="panel">
        <h3>References</h3>
        <div id="references-content" class="refs-list"></div>
      </div>
    </section>

    <!-- About Section -->
    <section id="section-about" class="section" aria-hidden="true">
      <div class="panel">
        <h3 id="about-title">ApollodB</h3>
        <p id="about-subtitle" class="muted">AI-Powered Music Emotion Analysis & EQ Optimization</p>
        <p class="small muted">By <span id="about-author">Parikshit Kumar</span> · <span id="about-location">California</span> · v<span id="about-version">1.0.0</span></p>

        <p>ApollodB maps audio to the valence–arousal space and derives emotion-aligned EQ curves. The frontend replicates the original Streamlit experience with a modern UI while preserving backend logic.</p>

        <div class="grid-2">
          <div>
            <h4>How it works</h4>
            <ul class="checklist">
              <li>Extracts audio features via librosa</li>
              <li>Predicts emotions using a TF model with neutral bias handling</li>
              <li>Generates EQ targets (Wavelet/Parametric/Graphic)</li>
              <li>Applies EQ and exports audio</li>
            </ul>
          </div>
          <div>
            <h4>What’s included</h4>
            <ul class="checklist">
              <li>Single & batch analysis</li>
              <li>Interactive VA plots & distributions</li>
              <li>EQ curves visualization and text export</li>
              <li>Per-track EQed audio and spectrograms</li>
            </ul>
          </div>
        </div>

        <h4 style="margin-top:1.5rem;">FAQs</h4>
        <div id="faq-content" class="faq-accordion"></div>
      </div>
    </section>

    <footer class="premium-footer">
      <small>Built by Parikshit Kumar</small>
    </footer>
  </main>

  <template id="single-template">
    <!-- Row 1: Emotion Results + VA Chart -->
    <div class="results-row">
      <div class="results-card metrics-card">
        <h4 class="card-title">Analysis Results</h4>
        <div class="metrics-grid">
          <div class="metric-item primary">
            <div class="metric-value" id="emotion"></div>
            <div class="metric-label">Primary Emotion</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="secondary"></div>
            <div class="metric-label">Secondary</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="valence"></div>
            <div class="metric-label">Valence</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="arousal"></div>
            <div class="metric-label">Arousal</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="confidence"></div>
            <div class="metric-label">Confidence</div>
          </div>
        </div>
      </div>
      <div class="results-card">
        <div id="va-chart" class="chart"></div>
      </div>
    </div>
    <!-- Row 2: EQ Curve -->
    <div class="results-row single-col">
      <div class="results-card">
        <div id="eq-chart" class="chart"></div>
        <details class="eq-details">
          <summary>View EQ Data</summary>
          <div class="eq-container" id="eq-text"></div>
        </details>
        <button id="download-eq-text">Download EQ Text</button>
      </div>
    </div>
  </template>

  <template id="batch-template">
    <div class="results-grid">
      <div class="left">
        <div class="metric-container"><div class="metric-value" id="songs"></div><div class="metric-label">Songs Analyzed</div></div>
        <div class="metric-container"><div class="metric-value" id="dom-emotion"></div><div class="metric-label">Dominant Emotion</div></div>
        <div class="metric-container"><div class="metric-value" id="avg-valence"></div><div class="metric-label">Average Valence</div></div>
        <div class="metric-container"><div class="metric-value" id="avg-arousal"></div><div class="metric-label">Average Arousal</div></div>
      </div>
      <div class="grid-2">
        <div id="va-chart" class="chart"></div>
        <div id="dist-chart" class="chart"></div>
      </div>
      <div>
        <h4>Aggregate EQ</h4>
        <div id="eq-chart" class="chart"></div>
        <div class="row" style="gap:8px; flex-wrap:wrap;">
          <button id="download-eq-text">Download EQ Text</button>
          <button id="server-zip" aria-label="Download all as server ZIP">Server ZIP (fast)</button>
        </div>
      </div>
      <div class="right">
        <div class="premium-card">
          <h3>Individual Downloads</h3>
          <div id="individual-downloads" class="col"></div>
          <div class="row" style="gap:8px; flex-wrap:wrap; margin-top:8px;">
            <button id="download-all-zip">Download All as ZIP</button>
            <button id="batch-export-apo">Export APO (Batch EQ)</button>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script src="app.js"></script>
</body>
</html>
